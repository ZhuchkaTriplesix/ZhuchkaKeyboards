# üß™ ZhuchkaKeyboards Test Suite

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è API —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–ª–∞–¥–æ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ conftest.py              # –û–±—â–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ unit/                    # Unit —Ç–µ—Å—Ç—ã (–±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)
‚îÇ   ‚îî‚îÄ‚îÄ test_inventory_api.py
‚îú‚îÄ‚îÄ integration/             # Integration —Ç–µ—Å—Ç—ã (—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏)
‚îÇ   ‚îú‚îÄ‚îÄ test_inventory_full.py
‚îÇ   ‚îî‚îÄ‚îÄ test_performance.py
‚îî‚îÄ‚îÄ README.md
```

## üé≠ –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit —Ç–µ—Å—Ç—ã (`tests/unit/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä—É—é—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É API –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: 
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –º–æ–∫–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –ë—ã—Å—Ç—Ä—ã–µ (–≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∑–∞ —Å–µ–∫—É–Ω–¥—ã)
  - –ù–µ —Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
  - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
- **–ó–∞–ø—É—Å–∫**: `make test-unit` –∏–ª–∏ `pytest tests/unit/ -m unit`

### 2. Integration —Ç–µ—Å—Ç—ã (`tests/integration/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–π workflow —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ò—Å–ø–æ–ª—å–∑—É—é—Ç SQLite –≤ –ø–∞–º—è—Ç–∏ –¥–ª—è –±—ã—Å—Ç—Ä–æ—Ç—ã
  - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø–æ–ª–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
  - –ü—Ä–æ–≤–µ—Ä—è—é—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
  - –¢—Ä–µ–±—É—é—Ç –∑–∞–ø—É—â–µ–Ω–Ω—ã–π backend (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–ó–∞–ø—É—Å–∫**: `make test-integration` –∏–ª–∏ `pytest tests/integration/ -m integration`

### 3. Performance —Ç–µ—Å—Ç—ã (`tests/integration/test_performance.py`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –¢–µ—Å—Ç–∏—Ä—É—é—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ò–∑–º–µ—Ä—è—é—Ç –≤—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞
  - –¢–µ—Å—Ç–∏—Ä—É—é—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å
  - –ü—Ä–æ–≤–µ—Ä—è—é—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
  - –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç bottlenecks
- **–ó–∞–ø—É—Å–∫**: `make test-performance`

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –±–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (Unit —Ç–µ—Å—Ç—ã)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements-test.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç—å unit —Ç–µ—Å—Ç—ã
make test-unit

# –ò–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
pytest tests/unit/test_inventory_api.py::TestWarehouseAPI::test_create_warehouse_success -v
```

### –ó–∞–ø—É—Å–∫ —Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ (Integration —Ç–µ—Å—Ç—ã)
```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å backend
make dev

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å integration —Ç–µ—Å—Ç—ã
make test-integration

# –ò–ª–∏ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
make dev-setup && make test
```

## üìä –ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### üè¢ Warehouse API
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∫–æ–¥–æ–≤
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 404

### üì¶ Items API  
- ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å–æ –≤—Å–µ–º–∏ –ø–æ–ª—è–º–∏
- ‚úÖ –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (–ø–æ —Ç–∏–ø—É, –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—É)
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ SKU
- ‚úÖ –ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ (–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è)

### üìä Inventory Levels API
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è–º–∏ –∑–∞–ø–∞—Å–æ–≤
- ‚úÖ –í—ã—á–∏—Å–ª—è–µ–º—ã–µ –ø–æ–ª—è (available_quantity)
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ —Å–∫–ª–∞–¥–∞–º –∏ —Ç–æ–≤–∞—Ä–∞–º
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª

### üîÑ Stock Movement API
- ‚úÖ –ü—Ä–∏—Ö–æ–¥/—Ä–∞—Å—Ö–æ–¥ —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ/—Å–Ω—è—Ç–∏–µ —Ä–µ–∑–µ—Ä–≤–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞
- ‚úÖ –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- ‚úÖ –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏–π

### üìà Analytics API
- ‚úÖ –¢–æ–≤–∞—Ä—ã —Å –Ω–∏–∑–∫–∏–º –æ—Å—Ç–∞—Ç–∫–æ–º
- ‚úÖ –°–≤–æ–¥–∫–∞ –ø–æ –∑–∞–ø–∞—Å–∞–º
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å–∫–ª–∞–¥–∞–º
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

## ‚ö° Performance –º–µ—Ç—Ä–∏–∫–∏

### –¶–µ–ª–µ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏:
- **–°–æ–∑–¥–∞–Ω–∏–µ —Å–∫–ª–∞–¥–∞**: < 500ms
- **–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤**: < 2s (100+ —Ç–æ–≤–∞—Ä–æ–≤)
- **–î–≤–∏–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞**: < 200ms
- **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ**: < 100ms
- **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞**: < 5s (–±–æ–ª—å—à–æ–π dataset)

### –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å:
- **50 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–≤–∏–∂–µ–Ω–∏–π**: –±–µ–∑ race conditions
- **100 —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏–π**: –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: 1000+ —Ç–æ–≤–∞—Ä–æ–≤

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
make test

# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
make test-quick

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–¥—É–ª—å
make test-inventory-unit
make test-inventory-integration

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest --cov=gateway/src/routers/inventory tests/

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest tests/ -v -s

# –¢–æ–ª—å–∫–æ –Ω–µ—É–¥–∞—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/ --lf

# –° –±–µ–Ω—á–º–∞—Ä–∫–∞–º–∏
pytest tests/integration/test_performance.py --benchmark-only

# HTML –æ—Ç—á–µ—Ç
pytest tests/ --html=report.html
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –î–ª—è unit —Ç–µ—Å—Ç–æ–≤:
```bash
# –¢–æ–ª—å–∫–æ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements-test.txt
```

### –î–ª—è integration —Ç–µ—Å—Ç–æ–≤:
```bash
# Docker –æ–∫—Ä—É–∂–µ–Ω–∏–µ
make dev

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
make health

# –õ–æ–≥–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
make logs
```

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### Unit —Ç–µ—Å—Ç (–ø—Ä–∏–º–µ—Ä):
```python
@pytest.mark.unit
def test_new_feature(mock_app: TestClient):
    # –ú–æ–∫–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
    with patch('routers.inventory.crud.some_function') as mock_func:
        mock_func.return_value = expected_result
        
        # –¢–µ—Å—Ç–∏—Ä—É–µ–º API
        response = mock_app.get("/api/inventory/new-endpoint")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        assert response.status_code == 200
        assert response.json()["field"] == "expected_value"
```

### Integration —Ç–µ—Å—Ç (–ø—Ä–∏–º–µ—Ä):
```python
@pytest.mark.integration
def test_full_workflow(integration_app: TestClient):
    # –°–æ–∑–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    response = integration_app.post("/api/inventory/items", json=item_data)
    item_id = response.json()["id"]
    
    # –¢–µ—Å—Ç–∏—Ä—É–µ–º workflow
    response = integration_app.get(f"/api/inventory/items/{item_id}")
    assert response.status_code == 200
```

## üö® Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å –æ—à–∏–±–∫–æ–π –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
# –†–µ—à–µ–Ω–∏–µ: –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
make dev
make health
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –†–µ—à–µ–Ω–∏–µ: –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
pytest tests/ -n auto

# –ò–ª–∏ —Ç–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest tests/unit/ -m unit
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–æ–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ —Ñ—É–Ω–∫—Ü–∏–∏
# ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
with patch('crud.get_item'):

# ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ  
with patch('routers.inventory.crud.get_item'):
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pytest.org/)
- [FastAPI —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](https://fastapi.tiangolo.com/tutorial/testing/)
- [SQLAlchemy —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](https://docs.sqlalchemy.org/en/20/orm/session_transaction.html#testing)
- [Async —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](https://pytest-asyncio.readthedocs.io/)
